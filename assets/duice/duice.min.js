/*!
 * duice - v0.3.9
 * git: https://gitbub.com/chomookun/duice
 * website: https://duice.chomookun.com
 * Released under the LGPL(GNU Lesser General Public License version 3) License
 */
var duice=function(e){"use strict";class t{static setNamespace(e){this.namespace=e}static getNamespace(){return this.namespace}static setDebugEnabled(e){sessionStorage.setItem(`${this.namespace}.traceEnabled`,JSON.stringify(e))}static isDebugEnabled(){const e=sessionStorage.getItem(`${this.namespace}.debugEnabled`);return!!e&&JSON.parse(e)}}t.namespace="duice";var s=window&&window.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,r){function l(e){try{o(n.next(e))}catch(e){r(e)}}function a(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,a)}o((n=n.apply(e,t||[])).next())}))};function n(e){return Array.isArray(e)}function i(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}function r(e){return null!=e&&null!=globalThis.Object.getOwnPropertyDescriptor(e,"_proxy_target_")}function l(e,t){globalThis.Object.defineProperty(e,"_proxy_target_",{value:t,writable:!0})}function a(e){return globalThis.Object.getOwnPropertyDescriptor(e,"_proxy_target_").value}function o(e,t){globalThis.Object.defineProperty(e,"_proxy_handler_",{value:t,writable:!0})}function h(e){return globalThis.Object.getOwnPropertyDescriptor(e,"_proxy_handler_").value}function c(){let e=t.getNamespace();return`*[data-${e}-bind]:not([data-${e}-id])`}function d(e){e.querySelectorAll(c()).forEach((e=>{y(e,"id","_")}))}function u(e,t){try{let s=new Function(`return this.${t};`).call(e);if(s)return s}catch(e){}try{let e=new Function(`return ${t};`).call(null);if(e)return e}catch(e){}}function m(e,t,n){return s(this,void 0,void 0,(function*(){try{let s=[],i=[];for(let e in n)s.push(e),i.push(n[e]);return yield Function(...s,e).call(t,...i)}catch(t){throw console.error(e,t),t}}))}function g(e,t){return s(this,void 0,void 0,(function*(){let s=E(e,"if");if(s){let n=yield m(s,e,t);return e.hidden=!n,n}return!0}))}function p(e,t){return s(this,void 0,void 0,(function*(){let s=E(e,"execute");return s?yield m(s,e,t):null}))}function f(e,s){let n=t.getNamespace();return e.hasAttribute(`data-${n}-${s}`)}function E(e,s){let n=t.getNamespace();return e.getAttribute(`data-${n}-${s}`)}function y(e,s,n){let i=t.getNamespace();e.setAttribute(`data-${i}-${s}`,n)}function v(...e){t.isDebugEnabled()&&console.trace(e)}function b(e,t){if(console.assert(e,t),!e)throw new Error(t||"Assertion Failed")}class x{}class w{constructor(){this.observers=[],this.notifyEnabled=!0}addObserver(e){this.observers.push(e)}removeObserver(e){for(let t=0,s=this.observers.length;t<s;t++)if(this.observers[t]===e)return void this.observers.splice(t,1)}suspendNotify(){this.notifyEnabled=!1}resumeNotify(){this.notifyEnabled=!0}notifyObservers(e){this.notifyEnabled&&this.observers.forEach((t=>{t.update(this,e)}))}}class D extends w{constructor(e,t,s){super(),this.htmlElement=e,this.bindData=t,this.context=s,y(this.htmlElement,"id",this.generateId());let n=h(t);b(n,"ProxyHandler is not found"),this.addObserver(n),n.addObserver(this)}generateId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}getHtmlElement(){return this.htmlElement}getContext(){return this.context}getBindData(){return this.bindData}}var I=window&&window.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,r){function l(e){try{o(n.next(e))}catch(e){r(e)}}function a(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,a)}o((n=n.apply(e,t||[])).next())}))};class H{constructor(){this.eventListeners=new Map}setParent(e){this.parent=e}getParent(){return this.parent}addEventListener(e,t){let s=this.eventListeners.get(e);s||(s=[],this.eventListeners.set(e,s)),s.push(t)}removeEventListener(e,t){let s=this.eventListeners.get(e);if(s){let e=s.indexOf(t);e>=0&&s.splice(e,1)}}clearEventListeners(e){this.eventListeners.delete(e)}dispatchEventListeners(e){return I(this,void 0,void 0,(function*(){let t=this.eventListeners.get(e.constructor),s=[];if(t)for(let n of t)s.push(yield n.call(this,e));if(this.parent){let t=yield this.parent.dispatchEventListeners(e);s=s.concat(t)}return s}))}}var L=window&&window.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,r){function l(e){try{o(n.next(e))}catch(e){r(e)}}function a(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,a)}o((n=n.apply(e,t||[])).next())}))};class C extends w{constructor(e){super(),this.readonlyProperties=new Map,this.disabledProperties=new Map,this.eventDispatcher=new H,this.eventEnabled=!0,this.target=e}setParent(e){this.parent=e,this.addObserver(e),e.addObserver(this),this.eventDispatcher.setParent(e.eventDispatcher)}getParent(){return this.parent}setTarget(e){this.target=e}getTarget(){return this.target}setReadonlyAll(e){this.readonlyAll=e,this.readonlyProperties.forEach(((t,s)=>{this.readonlyProperties.set(s,e)})),this.notifyObservers()}isReadonlyAll(){let e=!1;return this.parent&&(e=!0===this.parent.isReadonlyAll()),!0===this.readonlyAll&&(e=!0),!1===this.readonlyAll&&(e=!1),e}setReadonly(e,t){this.readonlyProperties.set(e,t),this.notifyObservers()}isReadonly(e){let t=!1;return t=!0===this.isReadonlyAll(),this.readonlyProperties.has(e)&&(t=!0===this.readonlyProperties.get(e)),t}setDisabledAll(e){this.disabledAll=e,this.disabledProperties.forEach(((t,s)=>{this.disabledProperties.set(s,e)})),this.notifyObservers()}isDisabledAll(){let e=!1;return this.parent&&(e=!0===this.parent.isDisabledAll()),!0===this.disabledAll&&(e=!0),!1===this.disabledAll&&(e=!1),e}setDisabled(e,t){this.disabledProperties.set(e,t),this.notifyObservers()}isDisabled(e){let t=!1;return t=!0===this.isDisabledAll(),this.disabledProperties.has(e)&&(t=!0===this.disabledProperties.get(e)),t}addEventListener(e,t){this.eventDispatcher.addEventListener(e,t)}removeEventListener(e,t){this.eventDispatcher.removeEventListener(e,t)}clearEventListeners(e){this.eventDispatcher.clearEventListeners(e)}suspendEvent(){this.eventEnabled=!1}resumeEvent(){this.eventEnabled=!0}dispatchEventListeners(e){return L(this,void 0,void 0,(function*(){return this.eventEnabled?this.eventDispatcher.dispatchEventListeners(e).then((e=>null!=e&&e.length>0?!e.some((e=>!1===e)):null)):null}))}}class P{constructor(e){this.pattern=e}format(e){if(!e)return e;let t="",s=this.pattern.split(""),n=e.split(""),i=0;for(let e=0,r=s.length;e<r;e++){let r=s[e];if(t+="#"===r?n[i++]||"":r,i>=n.length)break}return t}parse(e){if(!e)return e;let t="",s=this.pattern.split(""),n=e.split(""),i=0;for(let e=0,r=s.length;e<r;e++){"#"===s[e]?t+=n[i++]||"":i++}return t}}class O{constructor(e){this.scale=0,this.scale=e}format(e){if(isNaN(Number(e)))return"";let t;e=Number(e),t=this.scale>0?String(e.toFixed(this.scale)):String(e);let s=/(^[+-]?\d+)(\d{3})/;for(;s.test(t);)t=t.replace(s,"$1,$2");return t}parse(e){if(!e)return null;if(1===e.length&&/[+-]/.test(e)&&(e+="0"),e=e.replace(/,/gi,""),isNaN(Number(e)))throw"NaN";let t=Number(e);return this.scale>0&&(t=Number(t.toFixed(this.scale))),t}}class A{constructor(e){this.patternRex=/yyyy|yy|MM|dd|HH|hh|mm|ss/gi,this.pattern=e}format(e){if(!e)return"";let t=new Date(e);return e=this.pattern.replace(this.patternRex,(function(e){switch(e){case"yyyy":return t.getFullYear();case"yy":return String(t.getFullYear()%1e3).padStart(2,"0");case"MM":return String(t.getMonth()+1).padStart(2,"0");case"dd":return String(t.getDate()).padStart(2,"0");case"HH":return String(t.getHours()).padStart(2,"0");case"hh":return String(t.getHours()<=12?t.getHours():t.getHours()%12).padStart(2,"0");case"mm":return String(t.getMinutes()).padStart(2,"0");case"ss":return String(t.getSeconds()).padStart(2,"0");default:return e}}))}parse(e){if(!e)return null;let t,s=new Date(0,0,0,0,0,0);for(;null!=(t=this.patternRex.exec(this.pattern));){let n=t[0],i=t.index,r=n.length,l=e.substr(i,r);switch(l=l.padEnd(r,"0"),n){case"yyyy":{let e=parseInt(l);s.setFullYear(e);break}case"yy":{let e=parseInt(l),t=100*Math.floor((new Date).getFullYear()/100)+e;s.setFullYear(t);break}case"MM":{let e=parseInt(l);s.setMonth(e-1);break}case"dd":{let e=parseInt(l);s.setDate(e);break}case"HH":{let e=parseInt(l);s.setHours(e);break}case"hh":{let e=parseInt(l);s.setHours(e>12?e+12:e);break}case"mm":{let e=parseInt(l);s.setMinutes(e);break}case"ss":{let e=parseInt(l);s.setSeconds(e);break}}}let n=-1*(new Date).getTimezoneOffset(),i=n>=0?"+":"-",r=function(e){return(e<10?"0":"")+e};return s.getFullYear()+"-"+r(s.getMonth()+1)+"-"+r(s.getDate())+"T"+r(s.getHours())+":"+r(s.getMinutes())+":"+r(s.getSeconds())+i+r(Math.floor(Math.abs(n)/60))+":"+r(Math.abs(n)%60)}}class B{static getFormat(e){let t,s;const n=e.match(/^([a-zA-Z_][a-zA-Z0-9_]*)\((.*)\)$/);if(!n)throw new Error(`Invalid format: ${e}`);switch(t=n[1],s=n[2].split(",").map((e=>e.trim().replace(/^['"]|['"]$/g,""))),t){case"string":return new P(s[0]);case"number":return new O(parseInt(s[0]));case"date":return new A(s[0]);default:throw new Error(`Unknown format: ${t}`)}}}class T{constructor(e,t){this.element=e,this.data=t}getElement(){return this.element}getData(){return this.data}}class S extends T{constructor(e,t,s,n,i){super(e,t),this.property=s,this.value=n,this.index=i}getProperty(){return this.property}getValue(){return this.value}getIndex(){return this.index}}class N extends D{constructor(e,t,s){super(e,t,s),this.property=E(e,"property");let n=E(e,"format");n&&(this.format=B.getFormat(n))}getProperty(){return this.property}getFormat(){return this.format}render(){let e=Object.assign({},this.getContext()),t=E(this.getHtmlElement(),"bind"),s=t.split(".");s.length>1?e[s[0]]=u(e,s[0]):e[t]=this.getBindData(),g(this.htmlElement,e).then((t=>{if(!1===t)return;let s=h(this.getBindData());if(this.property){let e=s.getValue(this.property);this.setValue(e)}let n=s.isReadonly(this.property);this.setReadonly(n);let i=s.isDisabled(this.property);this.setDisabled(i),p(this.htmlElement,e).then()}))}update(e,t){v("ObjectElement.update",e,t),this.render()}setValue(e){null!=e?(e=this.getFormat()?this.getFormat().format(e):e,this.htmlElement.innerText=e):this.htmlElement.innerText=""}getValue(){let e=this.htmlElement.innerText;return e=e&&e.trim().length>0?this.getFormat()?this.getFormat().parse(e):e:null,e}setReadonly(e){}setDisabled(e){}getIndex(){let e=E(this.htmlElement,"index");if(e)return Number(e)}focus(){return!1}}class F extends T{constructor(e,t,s,n,i){super(e,t),this.property=s,this.value=n,this.index=i}getProperty(){return this.property}getValue(){return this.value}getIndex(){return this.index}}class R extends T{constructor(e,t,s){super(e,t),this.index=s}getIndex(){return this.index}}class V extends T{constructor(e,t,s,n){super(e,t),this.fromIndex=s,this.toIndex=n}getFromIndex(){return this.fromIndex}getToIndex(){return this.toIndex}}class M extends T{constructor(e,t,s){super(e,t),this.index=s}getIndex(){return this.index}}class _ extends T{constructor(e,t,s,n){super(e,t),this.fromIndex=s,this.toIndex=n}getFromIndex(){return this.fromIndex}getToIndex(){return this.toIndex}}class k extends C{constructor(e){super(e)}get(e,t,s){let n=this;const i=e[t];return"function"==typeof i?["push","unshift"].includes(t)?function(){let i;"push"===t?i=s.length:"unshift"===t&&(i=0);let r=[];for(let e in arguments)r.push(arguments[e]);return n.insertItem(e,i,...r),e.length}:["splice"].includes(t)?function(){let t=arguments[0],s=arguments[1],i=[];for(let n=t;n<t+s;n++)i.push(e[n]);let r=[];for(let e=2;e<arguments.length;e++)r.push(arguments[e]);return s>0&&n.deleteItem(e,t,s),r.length>0&&n.insertItem(e,t,...r),i}:["pop","shift"].includes(t)?function(){let i;"pop"===t?i=s.length-1:"shift"===t&&(i=0);let r=[e[i]];return n.deleteItem(e,i),r}:i.bind(e):i}set(e,t,s){return Reflect.set(e,t,s),"length"===t&&this.notifyObservers(null),!0}update(e,t){v("ArrayProxyHandler.update",e,t),e instanceof Y&&(t instanceof R&&this.dispatchEventListeners(t).then((e=>{if(!1===e)return;this.selectedItemIndex=t.getIndex();let s=new M(t.getElement(),t.getData(),this.selectedItemIndex);this.notifyObservers(s),this.dispatchEventListeners(s).then()})),t instanceof V&&this.dispatchEventListeners(t).then((e=>{if(!1===e)return;let s=this.getTarget().splice(t.getFromIndex(),1)[0];this.getTarget().splice(t.getToIndex(),0,s);let n=new _(t.getElement(),t.getData(),t.getFromIndex(),t.getToIndex());this.notifyObservers(n),this.dispatchEventListeners(n).then()}))),e instanceof j&&t instanceof S&&this.notifyObservers(t)}insertItem(e,t,...s){let n=h(e),i=a(e);s.forEach(((e,t)=>{if("object"==typeof e){let n=new z(e);h(n),s[t]=n}})),i.splice(t,0,...s),n.notifyObservers()}deleteItem(e,t,s){let n=h(e),i=a(e),r=t,l=s?t+s:t+1;i.slice(r,l);let o=t,c=s||1;i.splice(o,c),n.notifyObservers()}selectItem(e){this.selectedItemIndex=e;const t=new M(null,this.getTarget(),e);this.notifyObservers(t)}getSelectedItemIndex(){return this.selectedItemIndex}}class j extends C{constructor(e){super(e)}get(e,t,s){return Reflect.get(e,t,s)}set(e,t,s){return Reflect.set(e,t,s),this.notifyObservers(),!0}update(e,t){v("ObjectProxyHandler.update",e,t),e instanceof N&&t instanceof F&&this.dispatchEventListeners(t).then((s=>{if(!1===s)return void e.update(this,t);let n=e.getProperty(),i=e.getValue();this.setValue(n,i);let r=new S(t.getElement(),t.getData(),t.getProperty(),t.getValue(),t.getIndex());this.notifyObservers(r),this.dispatchEventListeners(r).then()}))}getValue(e){return e=e.replace(/\./g,"?."),new Function(`return this.${e};`).call(this.getTarget())}setValue(e,t){new Function("value",`this.${e} = value;`).call(this.getTarget(),t)}focus(e){this.observers.forEach((t=>{if(t instanceof N&&t.getProperty()===e&&t.focus())return!1}))}isReadonly(e){let t=super.isReadonly(e);return this.parent&&this.parent instanceof k&&(!0===this.parent.isReadonly(e)&&(t=!0),!1===this.parent.isReadonly(e)&&(t=!1)),t}isDisabled(e){let t=super.isDisabled(e);return this.parent&&this.parent instanceof k&&(!0===this.parent.isDisabled(e)&&(t=!0),!1===this.parent.isDisabled(e)&&(t=!1)),t}}class $ extends globalThis.Array{constructor(e){if(super(),e instanceof $)return e;let t=new k(e),s=new Proxy(e,t);l(s,e),o(s,t);let n=JSON.parse(JSON.stringify(e));return $.assign(s,n),$.save(s),s}static assign(e,t){let s=h(e);try{s.suspendEvent(),s.suspendNotify(),e.length=0;for(let n=0;n<t.length;n++){let r=t[n];if(i(r)){let t=new z(r);h(t).setParent(s),e[n]=t}else e[n]=r}}finally{s.resumeEvent(),s.resumeNotify()}s.notifyObservers()}static clear(e){let t=h(e);try{t.suspendEvent(),t.suspendNotify(),e.length=0}finally{t.resumeEvent(),t.resumeNotify()}t.notifyObservers()}static save(e){let t=JSON.stringify(e);globalThis.Object.defineProperty(e,"_origin_",{value:t,writable:!0})}static reset(e){let t=JSON.parse(globalThis.Object.getOwnPropertyDescriptor(e,"_origin_").value);this.assign(e,t)}static setReadonlyAll(e,t){h(e).setReadonlyAll(t)}static isReadonlyAll(e){return h(e).isReadonlyAll()}static setReadonly(e,t,s){h(e).setReadonly(t,s)}static isReadonly(e,t){return h(e).isReadonly(t)}static setDisabledAll(e,t){h(e).setDisabledAll(t)}static isDisabledAll(e){return h(e).isDisabledAll()}static setDisabled(e,t,s){h(e).setDisabled(t,s)}static isDisabled(e,t){return h(e).isDisabled(t)}static selectItem(e,t){return h(e).selectItem(t)}static getSelectedItemIndex(e){return h(e).getSelectedItemIndex()}static onItemSelecting(e,t){let s=h(e),n=R;s.clearEventListeners(n),s.addEventListener(n,t)}static onItemSelected(e,t){let s=h(e),n=M;s.clearEventListeners(n),s.addEventListener(n,t)}static onItemMoving(e,t){let s=h(e),n=V;s.clearEventListeners(n),s.addEventListener(n,t)}static onItemMoved(e,t){let s=h(e),n=_;s.clearEventListeners(n),s.addEventListener(n,t)}static onPropertyChanging(e,t){let s=h(e),n=F;s.clearEventListeners(n),s.addEventListener(n,t)}static onPropertyChanged(e,t){let s=h(e),n=S;s.clearEventListeners(n),s.addEventListener(n,t)}}class z extends globalThis.Object{constructor(e){if(super(),e instanceof z)return e;let t=new j(e),s=new Proxy(e,t);l(s,e),o(s,t);let n=JSON.parse(JSON.stringify(e));return z.assign(s,n),z.save(s),s}static assign(e,t){let s=h(e);try{s.suspendEvent(),s.suspendNotify();for(let l in t){let a=t[l],o=e[l];n(a)?r(o)?$.assign(o,a):(e[l]=new $(a),h(e[l]).setParent(s)):i(a)?r(o)?z.assign(o,a):(e[l]=new z(a),h(e[l]).setParent(s)):e[l]=a}}finally{s.resumeEvent(),s.resumeNotify()}s.notifyObservers(null)}static clear(e){let t=h(e);try{t.suspendEvent(),t.suspendNotify();for(let t in e){let s=e[t];n(s)?r(s)?$.clear(s):e[t]=[]:i(s)&&r(s)?z.clear(s):e[t]=null}}finally{t.resumeEvent(),t.resumeNotify()}t.notifyObservers(null)}static save(e){let t=JSON.stringify(e);globalThis.Object.defineProperty(e,"_origin_",{value:t,writable:!0})}static reset(e){let t=JSON.parse(globalThis.Object.getOwnPropertyDescriptor(e,"_origin_").value);this.assign(e,t)}static setReadonlyAll(e,t){h(e).setReadonlyAll(t)}static isReadonlyAll(e){return h(e).isReadonlyAll()}static setReadonly(e,t,s){h(e).setReadonly(t,s)}static isReadonly(e,t){return h(e).isReadonly(t)}static setDisabledAll(e,t){h(e).setDisabledAll(t)}static isDisabledAll(e){return h(e).isDisabledAll()}static setDisabled(e,t,s){h(e).setDisabled(t,s)}static isDisabled(e,t){return h(e).isDisabled(t)}static focus(e,t){h(e).focus(t)}static onPropertyChanging(e,t){let s=h(e);s.clearEventListeners(F),s.addEventListener(F,t)}static onPropertyChanged(e,t){let s=h(e);s.clearEventListeners(S),s.addEventListener(S,t)}}class Y extends D{constructor(e,t,s){super(e.cloneNode(!0),t,s),this.editable=!1,this.slot=document.createElement("slot"),this.itemHtmlElements=[],this.foreach=E(e,"foreach"),this.recursive=E(e,"recursive"),this.editable="true"===E(e,"editable"),this.selectedItemClass=E(e,"selected-item-class"),e.replaceWith(this.slot),d(e)}render(){var e,t;let s=this.getBindData();if(this.itemHtmlElements.forEach((e=>{e.parentNode.removeChild(e)})),this.itemHtmlElements.length=0,this.foreach){let n=this.foreach.split(","),i=n[0].trim(),r=null===(e=n[1])||void 0===e?void 0:e.trim();if(this.recursive){let e=this.recursive.split(","),n=e[0].trim(),l=null===(t=e[1])||void 0===t?void 0:t.trim();const a=this;let o=function(e,t,h){for(let c=0;c<e.length;c++){const d=e[c];if(d[l]===t){let t=Object.assign({},a.getContext());t[i]=d,t[r]=new z({index:c,count:c+1,size:s.length,first:0===c,last:s.length==c+1,depth:h}),a.createItemHtmlElement(c,t);let l=d[n];o(e,l,h+1)}}};o(s,null,0)}else for(let e=0;e<s.length;e++){let t=s[e],n=Object.assign({},this.getContext());n[i]=t,n[r]=new z({index:e,count:e+1,size:s.length,first:0===e,last:s.length==e+1}),this.createItemHtmlElement(e,n)}}else{let e=this.getHtmlElement().cloneNode(!0),t=Object.assign({},this.getContext());Z.initialize(e,this.getContext()),this.itemHtmlElements.push(e),this.slot.parentNode.insertBefore(e,this.slot),g(e,t).then((s=>{!1!==s&&p(e,t).then()}))}}createItemHtmlElement(e,t){let s=this.getHtmlElement().cloneNode(!0);y(s,"index",e.toString());let n=this;this.editable&&(s.setAttribute("draggable","true"),s.addEventListener("dragstart",(e=>{let t=E(e.currentTarget,"index");e.dataTransfer.setData("text",t)})),s.addEventListener("dragover",(e=>{e.preventDefault(),e.stopPropagation()})),s.addEventListener("drop",(e=>{e.preventDefault(),e.stopPropagation();let t=this.getHtmlElement(),s=a(this.getBindData()),i=parseInt(e.dataTransfer.getData("text")),r=parseInt(E(e.currentTarget,"index")),l=new V(t,s,i,r);n.notifyObservers(l)}))),Z.initialize(s,t,e),this.itemHtmlElements.push(s),this.slot.parentNode.insertBefore(s,this.slot),s.addEventListener("click",(t=>{t.stopPropagation();let s=this.getHtmlElement(),n=a(this.getBindData()),i=new R(s,n,e);this.notifyObservers(i)})),g(s,t).then((e=>{!1!==e&&p(s,t).then()}))}update(e,t){var s;if(v("ArrayElement.update",e,t),e instanceof k){if(t instanceof M){if(this.selectedItemClass){this.itemHtmlElements.forEach((e=>e.classList.remove(this.selectedItemClass))),t.getIndex()>=0&&this.itemHtmlElements.forEach((e=>{e.dataset.duiceIndex===t.getIndex().toString()&&e.classList.add(this.selectedItemClass)}))}return}if(t instanceof _)return void this.render();if(t instanceof S){if(!this.recursive)return;{let e=null===(s=this.recursive.split(",")[1])||void 0===s?void 0:s.trim();if(t.getProperty()===e)return void this.render()}}}this.render()}}class J extends x{createElement(e,t,s){return new Y(e,t,s)}}class W extends x{createElement(e,t,s){return this.doCreateElement(e,t,s)}}class X extends x{createElement(e,t,s){return new N(e,t,s)}}class U{static register(e,t){t instanceof J?this.arrayElementFactories.set(e,t):t instanceof X?this.objectElementFactories.set(e,t):t instanceof W&&this.customElementFactories.set(e,t),e.includes("-")&&globalThis.customElements.define(e,class extends HTMLElement{})}static getFactory(e,t,s){let n=e.tagName.toLowerCase();return this.customElementFactories.has(n)?this.customElementFactories.get(n):Array.isArray(t)?this.arrayElementFactories.has(n)?this.arrayElementFactories.get(n):this.defaultArrayElementFactory:this.objectElementFactories.has(n)?this.objectElementFactories.get(n):this.defaultObjectElementFactory}}U.defaultObjectElementFactory=new X,U.defaultArrayElementFactory=new J,U.objectElementFactories=new Map,U.arrayElementFactories=new Map,U.customElementFactories=new Map;class Z{static initialize(e,t,s){e.querySelectorAll(c()).forEach((e=>{var n,i;if(e instanceof HTMLElement){const r=e;if(!f(r,"id"))try{let e=E(r,"bind"),l=u(t,e);null===(i=null===(n=U.getFactory(r,l,t))||void 0===n?void 0:n.createElement(r,l,t))||void 0===i||i.render(),void 0!==s&&y(r,"index",s.toString())}catch(e){console.error(e,r.outerHTML,t)}}}))}}var G=window&&window.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,r){function l(e){try{o(n.next(e))}catch(e){r(e)}}function a(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,a)}o((n=n.apply(e,t||[])).next())}))};class K extends N{constructor(e,t,s){super(e,t,s),this.editable=!1,this.clearButtonImg="data:image/svg+xml;base64,"+window.btoa('<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path opacity="0.4" d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="#292D32"></path> <path d="M13.0594 12.0001L15.3594 9.70011C15.6494 9.41011 15.6494 8.93011 15.3594 8.64011C15.0694 8.35011 14.5894 8.35011 14.2994 8.64011L11.9994 10.9401L9.69937 8.64011C9.40937 8.35011 8.92937 8.35011 8.63938 8.64011C8.34938 8.93011 8.34938 9.41011 8.63938 9.70011L10.9394 12.0001L8.63938 14.3001C8.34938 14.5901 8.34938 15.0701 8.63938 15.3601C8.78938 15.5101 8.97937 15.5801 9.16937 15.5801C9.35937 15.5801 9.54937 15.5101 9.69937 15.3601L11.9994 13.0601L14.2994 15.3601C14.4494 15.5101 14.6394 15.5801 14.8294 15.5801C15.0194 15.5801 15.2094 15.5101 15.3594 15.3601C15.6494 15.0701 15.6494 14.5901 15.3594 14.3001L13.0594 12.0001Z" fill="#292D32"></path> </g></svg>'),this.readonly=!1,this.disabled=!1,this.originSrc=String(this.getHtmlElement().src),this.editable="true"===E(this.getHtmlElement(),"editable"),this.editable&&(this.getHtmlElement().style.cursor="pointer",this.getHtmlElement().addEventListener("click",(e=>{this.changeImage()})),this.clearButton=document.createElement("img"),this.clearButton.src=this.clearButtonImg,this.clearButton.style.cursor="pointer",this.clearButton.style.width="16px",this.clearButton.style.height="16px",this.clearButton.addEventListener("mouseout",(e=>{this.hideClearImageButton()}),!0),this.clearButton.addEventListener("click",(e=>{this.clearImage()})),this.getHtmlElement().addEventListener("mouseover",(e=>{this.showClearImageButton()}),!0),this.getHtmlElement().addEventListener("mouseout",(e=>{e.relatedTarget!==this.clearButton&&this.hideClearImageButton()}),!0));let n=E(this.getHtmlElement(),"size");if(n){let e=n.split(",");this.width=parseInt(e[0].trim()),this.height=parseInt(e[1].trim())}}showClearImageButton(){this.getHtmlElement().parentNode.insertBefore(this.clearButton,this.getHtmlElement().nextSibling),this.clearButton.style.position="absolute",this.clearButton.style.zIndex="100"}hideClearImageButton(){this.getHtmlElement().parentNode.removeChild(this.clearButton)}clearImage(){this.originSrc?this.getHtmlElement().src=this.originSrc:this.getHtmlElement().src=null;let e=this.getHtmlElement(),t=a(this.getBindData()),s=new F(e,t,this.getProperty(),this.getValue(),this.getIndex());this.notifyObservers(s)}changeImage(){let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/gif, image/jpeg, image/png, image/svg+xml");let t=this;e.addEventListener("change",(function(e){let s=new FileReader;this.files&&this.files[0]&&(s.addEventListener("load",(e=>G(this,void 0,void 0,(function*(){let s,n=e.target.result;s=t.width&&t.height?yield t.convertImage(n,t.width,t.height):yield t.convertImage(n),t.setValue(s);let i=t.getHtmlElement(),r=a(t.getBindData()),l=new F(i,r,t.getProperty(),t.getValue(),t.getIndex());t.notifyObservers(l)})))),s.readAsDataURL(this.files[0])),e.preventDefault(),e.stopPropagation()})),e.click()}convertImage(e,t,s){return new Promise((function(n,i){try{let i=document.createElement("canvas"),r=i.getContext("2d"),l=new Image;l.onload=function(){t&&s?(i.width=t,i.height=s,r.drawImage(l,0,0,t,s)):(i.width=l.naturalWidth,i.height=l.naturalHeight,r.drawImage(l,0,0));let e=i.toDataURL("image/png");n(e)},l.src=e}catch(e){i(e)}}))}setValue(e){this.getHtmlElement().src=e||this.originSrc}getValue(){let e=this.getHtmlElement().src;return e===this.originSrc?null:e}setReadonly(e){this.readonly=e,this.getHtmlElement().style.pointerEvents=this.readonly||this.disabled?"none":"unset"}setDisabled(e){this.disabled=e,this.getHtmlElement().style.pointerEvents=this.disabled||this.readonly?"none":"unset"}}class q extends X{createElement(e,t,s){return new K(e,t,s)}}U.register("img",new q);class Q extends N{constructor(e,t,s){super(e,t,s),this.getHtmlElement().addEventListener("change",(e=>{let t=this.getHtmlElement(),s=a(this.getBindData()),n=new F(t,s,this.getProperty(),this.getValue(),this.getIndex());this.notifyObservers(n)}),!0),this.getHtmlElement().setAttribute("autocomplete","off")}setValue(e){e=null!=e?this.getFormat()?this.getFormat().format(e):e:"",this.getHtmlElement().value=e}getValue(){let e=this.getHtmlElement().value;return e=e?this.getFormat()?this.getFormat().parse(e):e:null,e}setReadonly(e){this.getHtmlElement().readOnly=e}setDisabled(e){e?this.getHtmlElement().setAttribute("disabled","disabled"):this.getHtmlElement().removeAttribute("disabled")}focus(){return this.getHtmlElement().focus(),!0}}class ee extends Q{constructor(e,t,s){super(e,t,s),this.getHtmlElement().setAttribute("type","text"),this.getHtmlElement().style.textAlign="right",this.getHtmlElement().addEventListener("keypress",(e=>{!1===/[\d|\.|,]/.test(e.key)&&e.preventDefault()}))}getValue(){let e=super.getValue();return Number(e)}}class te extends Q{constructor(e,t,s){super(e,t,s),this.trueValue=!0,this.falseValue=!1;let n=E(this.getHtmlElement(),"true-value");this.trueValue=n||this.trueValue;let i=E(this.getHtmlElement(),"false-value");this.falseValue=i||this.falseValue}setValue(e){e===this.trueValue?this.getHtmlElement().checked=!0:this.htmlElement.checked=!1}getValue(){return this.htmlElement.checked?this.trueValue:this.falseValue}disableClick(e){e.preventDefault()}setReadonly(e){v("InputCheckboxElement.setReadonly",e),e?this.getHtmlElement().addEventListener("click",this.disableClick):this.getHtmlElement().removeEventListener("click",this.disableClick)}}class se extends Q{constructor(e,t,s){super(e,t,s),this.dateFormat=new A("yyyy-MM-ddTHH:mm")}setValue(e){this.getHtmlElement().value=e?this.dateFormat.format(e):""}getValue(){let e=this.getHtmlElement().value;return e?new Date(e).toISOString():null}}class ne extends Q{constructor(e,t,s){super(e,t,s)}setValue(e){this.getHtmlElement().checked=this.getHtmlElement().value===e}getValue(){return this.getHtmlElement().value}setReadonly(e){this.getHtmlElement().style.pointerEvents=e?"none":""}}class ie extends Q{constructor(e,t,s){super(e,t,s),this.trueValue=!0,this.falseValue=!1}setReadonly(e){v("InputRangeElement.setReadonly",e),this.getHtmlElement().readOnly=e,e?(this.getHtmlElement().addEventListener("mousedown",this.disableEvent),this.getHtmlElement().addEventListener("touchstart",this.disableEvent)):(this.getHtmlElement().removeEventListener("mousedown",this.disableEvent),this.getHtmlElement().removeEventListener("touchstart",this.disableEvent))}disableEvent(e){return e.preventDefault(),!1}}class re extends X{createElement(e,t,s){switch(e.getAttribute("type")){case"number":return new ee(e,t,s);case"checkbox":return new te(e,t,s);case"radio":return new ne(e,t,s);case"datetime-local":return new se(e,t,s);case"range":return new ie(e,t,s);default:return new Q(e,t,s)}}}U.register("input",new re);class le extends N{constructor(e,t,s){super(e,t,s),this.defaultOptions=[];for(let e=0;e<this.getHtmlElement().options.length;e++)this.defaultOptions.push(this.getHtmlElement().options[e]);this.option=E(this.getHtmlElement(),"option"),this.optionValueProperty=E(this.getHtmlElement(),"option-value-property"),this.optionTextProperty=E(this.getHtmlElement(),"option-text-property"),this.getHtmlElement().addEventListener("change",(e=>{let t=this.getHtmlElement(),s=a(this.getBindData()),n=new F(t,s,this.getProperty(),this.getValue(),this.getIndex());this.notifyObservers(n)}),!0)}render(){this.createOptions(),super.render()}createOptions(){let e=this.getHtmlElement().value;if(this.getHtmlElement().innerHTML="",this.defaultOptions.forEach((e=>{this.getHtmlElement().appendChild(e)})),this.option){let e=u(this.getContext(),this.option);e&&e.forEach((e=>{let t=document.createElement("option");t.value=e[this.optionValueProperty],t.appendChild(document.createTextNode(e[this.optionTextProperty])),this.getHtmlElement().appendChild(t)}))}this.getHtmlElement().value=e}setValue(e){if(this.getHtmlElement().value=e,!e)for(let e=0;e<this.getHtmlElement().options.length;e++){let t=this.getHtmlElement().options[e];if(!t.nodeValue){t.selected=!0;break}}}getValue(){let e=this.getHtmlElement().value;return(!e||e.trim().length<1)&&(e=null),e}setReadonly(e){this.getHtmlElement().style.pointerEvents=e?"none":""}setDisabled(e){e?this.getHtmlElement().setAttribute("disabled","disabled"):this.getHtmlElement().removeAttribute("disabled")}}class ae extends X{createElement(e,t,s){return new le(e,t,s)}}U.register("select",new ae);class oe extends N{constructor(e,t,s){super(e,t,s),this.getHtmlElement().addEventListener("change",(e=>{let t=this.getHtmlElement(),s=a(this.getBindData()),n=new F(t,s,this.getProperty(),this.getValue(),this.getIndex());this.notifyObservers(n)}),!0)}setValue(e){this.getHtmlElement().value=null!=e?e:""}getValue(){let e=this.getHtmlElement().value;return null!=e&&e.length>0?e:null}setReadonly(e){e?this.getHtmlElement().setAttribute("readonly","readonly"):this.getHtmlElement().removeAttribute("readonly")}setDisabled(e){e?this.getHtmlElement().setAttribute("disabled","disabled"):this.getHtmlElement().removeAttribute("disabled")}}class he extends X{createElement(e,t,s){return new oe(e,t,s)}}U.register("textarea",new he);var ce=window&&window.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,r){function l(e){try{o(n.next(e))}catch(e){r(e)}}function a(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,a)}o((n=n.apply(e,t||[])).next())}))};class de{constructor(e){this.dialogElement=e;let t=this;this.dialogElement.style.position="absolute",this.dialogElement.style.left="0",this.dialogElement.style.right="0",this.dialogElement.style.overflowX="hidden",this.dialogElement.style.boxSizing="border-box",this.dialogElement.style.maxWidth="100%",this.header=document.createElement("div"),this.dialogElement.appendChild(this.header),this.header.style.display="flex",this.header.style.justifyContent="end",this.header.style.lineHeight="2rem",this.header.style.position="absolute",this.header.style.left="0",this.header.style.top="0",this.header.style.width="100%",this.header.style.cursor="pointer",this.header.onmousedown=function(e){let s=0,n=0,i=0,r=0;i=e.clientX,r=e.clientY,window.document.onmouseup=function(e){window.document.onmousemove=null,window.document.onmouseup=null},window.document.onmousemove=function(e){s=i-e.clientX,n=r-e.clientY,i=e.clientX,r=e.clientY,t.dialogElement.style.left=t.dialogElement.offsetLeft-s+"px",t.dialogElement.style.top=t.dialogElement.offsetTop-n+"px"}},this.closeButton=document.createElement("span"),this.closeButton.innerHTML="&#10005;",this.closeButton.style.fontFamily="monospace",this.closeButton.style.fontSize="large",this.closeButton.style.marginLeft="0.5rem",this.closeButton.style.marginRight="0.5rem",this.closeButton.addEventListener("click",(e=>{t.hide(),t.close()})),this.dialogElement.addEventListener("scroll",(()=>{const e=this.dialogElement.scrollTop;this.header.style.top=`${e}px`})),this.header.appendChild(this.closeButton),window.addEventListener("resize",(function(e){t.movePositionToCenter()}))}onOpening(e){return this.openingListener=e,this}onOpened(e){return this.openedListener=e,this}onClosing(e){return this.closingListener=e,this}onClosed(e){return this.closedListener=e,this}movePositionToCenter(){window.getComputedStyle(this.dialogElement),this.dialogElement.style.boxSizing="border-box";let e=this.dialogElement.offsetWidth,t=this.dialogElement.offsetHeight,s=window.scrollX,n=window.scrollY;this.dialogElement.style.left=Math.max(0,window.innerWidth/2-e/2)+s+"px",this.dialogElement.style.top=Math.max(0,window.innerHeight/3-t/3)+n+"px"}getDialogElement(){return this.dialogElement}show(){let e=window.scrollX,t=window.scrollY;window.document.body.appendChild(this.dialogElement),this.dialogElement.showModal(),window.scrollTo(e,t),this.movePositionToCenter()}hide(){this.dialogElement.close()}open(){return ce(this,void 0,void 0,(function*(){if(this.openingListener&&0==this.openingListener.call(this))return;this.show(),this.openedListener&&this.openedListener.call(this);let e=this;return this.promise=new Promise((function(t,s){e.promiseResolve=t,e.promiseReject=s})),this.promise}))}close(...e){this.closingListener&&0==this.closingListener.call(this)||(this.closedListener&&this.closedListener.call(this),this.hide(),this.promiseResolve(...e))}}return globalThis.document&&document.addEventListener("DOMContentLoaded",(e=>{Z.initialize(document.documentElement,{})})),globalThis.window&&(window.addEventListener("popstate",(e=>{document.dispatchEvent(new CustomEvent("DOMContentLoaded"))})),window.addEventListener("pageshow",(e=>{e.persisted&&document.dispatchEvent(new CustomEvent("DOMContentLoaded"))}))),e.AlertDialog=class extends de{constructor(e){super(document.createElement("dialog")),this.getDialogElement().style.padding="1rem",this.getDialogElement().style.minWidth="20rem",this.getDialogElement().style.textAlign="center",this.messagePre=document.createElement("pre"),this.messagePre.style.whiteSpace="pre-wrap",this.messagePre.style.marginTop="1rem",this.messagePre.style.marginBottom="1rem",this.messagePre.innerHTML=e,this.getDialogElement().appendChild(this.messagePre),this.confirmButton=document.createElement("button"),this.confirmButton.appendChild(document.createTextNode("OK")),this.confirmButton.style.width="5em",this.confirmButton.style.cursor="pointer",this.confirmButton.addEventListener("click",(e=>{this.confirm()})),this.getDialogElement().appendChild(this.confirmButton)}open(){let e=super.open();return this.confirmButton.focus(),e}confirm(){super.close(),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}close(){super.close(),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}},e.ArrayElement=Y,e.ArrayElementFactory=J,e.ArrayProxy=$,e.Configuration=t,e.ConfirmDialog=class extends de{constructor(e){super(document.createElement("dialog")),this.getDialogElement().style.padding="1rem",this.getDialogElement().style.minWidth="20rem",this.getDialogElement().style.textAlign="center",this.messagePre=document.createElement("pre"),this.messagePre.style.whiteSpace="pre-wrap",this.messagePre.style.marginTop="1rem",this.messagePre.style.marginBottom="1rem",this.messagePre.innerHTML=e,this.getDialogElement().appendChild(this.messagePre),this.cancelButton=document.createElement("button"),this.cancelButton.appendChild(document.createTextNode("Cancel")),this.cancelButton.style.width="5em",this.cancelButton.style.cursor="pointer",this.cancelButton.addEventListener("click",(e=>{this.cancel()})),this.getDialogElement().appendChild(this.cancelButton),this.getDialogElement().appendChild(document.createTextNode(" ")),this.confirmButton=document.createElement("button"),this.confirmButton.appendChild(document.createTextNode("OK")),this.confirmButton.style.width="5em",this.confirmButton.style.cursor="pointer",this.confirmButton.addEventListener("click",(e=>{this.confirm()})),this.getDialogElement().appendChild(this.confirmButton)}open(){let e=super.open();return this.confirmButton.focus(),e}close(...e){super.close(!1),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}confirm(){super.close(!0),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}cancel(){super.close(!1),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}},e.CustomElement=class extends D{constructor(e,t,s){super(e,t,s)}render(){g(this.getHtmlElement(),this.getContext()).then((e=>{0!=e&&(this.doRender(this.getBindData()),Z.initialize(this.getHtmlElement(),this.getContext()),p(this.getHtmlElement(),this.getContext()).then())}))}update(e,t){v("ObjectElement.update",e,t),e instanceof C&&this.doUpdate(e.getTarget())}},e.CustomElementFactory=W,e.Dialog=de,e.ElementRegistry=U,e.ImgElementFactory=q,e.Initializer=Z,e.InputElementFactory=re,e.ItemMovedEvent=_,e.ItemMovingEvent=V,e.ItemSelectedEvent=M,e.ItemSelectingEvent=R,e.ObjectElement=N,e.ObjectElementFactory=X,e.ObjectProxy=z,e.PromptDialog=class extends de{constructor(e,t){super(document.createElement("dialog")),this.getDialogElement().style.padding="1rem",this.getDialogElement().style.minWidth="20rem",this.getDialogElement().style.textAlign="center",this.messagePre=document.createElement("pre"),this.messagePre.style.whiteSpace="pre-wrap",this.messagePre.style.marginTop="1rem",this.messagePre.style.marginBottom="1rem",this.messagePre.innerHTML=e,this.getDialogElement().appendChild(this.messagePre),this.promptInput=document.createElement("input"),this.promptInput.style.textAlign="center",this.promptInput.style.marginBottom="1rem",this.promptInput.style.width="100%",t&&(this.promptInput.type=t),this.getDialogElement().appendChild(this.promptInput),this.cancelButton=document.createElement("button"),this.cancelButton.appendChild(document.createTextNode("Cancel")),this.cancelButton.style.width="5em",this.cancelButton.style.cursor="pointer",this.cancelButton.addEventListener("click",(e=>{this.cancel()})),this.getDialogElement().appendChild(this.cancelButton),this.getDialogElement().appendChild(document.createTextNode(" ")),this.confirmButton=document.createElement("button"),this.confirmButton.appendChild(document.createTextNode("OK")),this.confirmButton.style.width="5em",this.confirmButton.style.cursor="pointer",this.confirmButton.addEventListener("click",(e=>{this.confirm(this.promptInput.value)})),this.getDialogElement().appendChild(this.confirmButton)}open(){let e=super.open();return this.promptInput.focus(),e}close(...e){super.close(),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}confirm(e){super.close(e),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}cancel(){super.close(),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}},e.PropertyChangedEvent=S,e.PropertyChangingEvent=F,e.ProxyHandler=C,e.SelectElementFactory=ae,e.TabFolder=class{constructor(){this.items=[]}addItem(e){e.setTabFolder(this),e.setTabIndex(this.items.length),this.items.push(e)}setActive(e){for(let t=0;t<this.items.length;t++)this.items[t].setActive(t===e)}},e.TabItem=class{constructor(e,t,s){this.button=e,this.content=t,this.listener=s,e.style.cursor="pointer";let n=this;e.addEventListener("click",(()=>{n.tabFolder.setActive(n.tabIndex)})),this.setActive(!1)}setTabFolder(e){this.tabFolder=e}setTabIndex(e){this.tabIndex=e}setActive(e){e?(this.button.style.opacity="unset",this.content.removeAttribute("hidden"),this.listener.call(this)):(this.button.style.opacity="0.5",this.content.setAttribute("hidden",String(!0)))}},e.TextareaElementFactory=he,e.assert=b,e.debug=v,e.findVariable=u,e.getElementAttribute=E,e.getElementQuerySelector=c,e.getProxyHandler=h,e.getProxyTarget=a,e.hasElementAttribute=f,e.isArray=n,e.isObject=i,e.isPrimitive=function(e){return e!==Object(e)},e.isProxy=r,e.markInitialized=d,e.runCode=m,e.runExecuteCode=p,e.runIfCode=g,e.setElementAttribute=y,e.setProxyHandler=o,e.setProxyTarget=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=duice.min.js.map
