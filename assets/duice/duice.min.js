/*!
 * duice - v0.2.60
 * git: https://gitbub.com/chomookun/duice
 * website: https://duice.chomookun.com
 * Released under the LGPL(GNU Lesser General Public License version 3) License
 */
var duice=function(e){"use strict";class t{static setNamespace(e){this.namespace=e}static getNamespace(){return this.namespace}}function s(){let e=t.getNamespace();return`*[data-${e}-bind]:not([data-${e}-id])`}function i(e){e.querySelectorAll(s()).forEach((e=>{c(e,"id","_")}))}function n(e,t){try{let s=new Function(`return this.${t};`).call(e);if(s)return s}catch(e){}try{let e=new Function(`return ${t};`).call(null);if(e)return e}catch(e){}console.warn(`Object[${t}] is not found`)}function r(e,t,s){try{let i=[],n=[];for(let e in s)i.push(e),n.push(s[e]);return Function(...i,e).call(t,...n)}catch(t){throw console.error(e,t),t}}function l(e,t){let s=h(e,"if");if(s){let i=r(s,e,t);e.hidden=!i}}function a(e,t){let s=h(e,"execute");s&&r(s,e,t)}function o(e,s){let i=t.getNamespace();return e.hasAttribute(`data-${i}-${s}`)}function h(e,s){let i=t.getNamespace();return e.getAttribute(`data-${i}-${s}`)}function c(e,s,i){let n=t.getNamespace();e.setAttribute(`data-${n}-${s}`,i)}function d(e,t){if(console.assert(e,t),!e)throw new Error(t||"Assertion Failed")}t.namespace="duice";class u{}class m{constructor(){this.observers=[],this.notifyEnabled=!0}addObserver(e){this.observers.push(e)}removeObserver(e){for(let t=0,s=this.observers.length;t<s;t++)if(this.observers[t]===e)return void this.observers.splice(t,1)}suspendNotify(){this.notifyEnabled=!1}resumeNotify(){this.notifyEnabled=!0}notifyObservers(e){this.notifyEnabled&&this.observers.forEach((t=>{t.update(this,e)}))}}class g extends m{constructor(e,t,s){var i;super(),this.htmlElement=e,this.bindData=t,this.context=s,c(this.htmlElement,"id",this.generateId());let n=null===(i=globalThis.Object.getOwnPropertyDescriptor(this.bindData,"_handler_"))||void 0===i?void 0:i.value;d(n,"DataHandler is not found"),this.addObserver(n),n.addObserver(this)}generateId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}getHtmlElement(){return this.htmlElement}getContext(){return this.context}getBindData(){return this.bindData}}class p{constructor(e){this.source=e}}class y extends m{constructor(){super(),this.readonlyAll=!1,this.readonly=new Set,this.disableAll=!1,this.disable=new Set,this.listenerEnabled=!0}setTarget(e){this.target=e}getTarget(){return this.target}setReadonlyAll(e){this.readonlyAll=e,e||this.readonly.clear(),this.notifyObservers(new p(this))}isReadonlyAll(){return this.readonlyAll}setReadonly(e,t){t?this.readonly.add(e):this.readonly.delete(e),this.notifyObservers(new p(this))}isReadonly(e){return this.readonlyAll||this.readonly.has(e)}setDisableAll(e){this.disableAll=e,e||this.disable.clear(),this.notifyObservers(new p(this))}isDisableAll(){return this.disableAll}setDisable(e,t){t?this.disable.add(e):this.disable.delete(e),this.notifyObservers(new p(this))}isDisable(e){return this.disableAll||this.disable.has(e)}suspendListener(){this.listenerEnabled=!1}resumeListener(){this.listenerEnabled=!0}checkListener(e,t){if(this.listenerEnabled&&e){if(0==e.call(this.getTarget(),t))return!1}return!0}}class f{constructor(e){this.pattern=e}format(e){if(!e)return e;let t="",s=this.pattern.split(""),i=e.split(""),n=0;for(let e=0,r=s.length;e<r;e++){let r=s[e];if(t+="#"===r?i[n++]||"":r,n>=i.length)break}return t}parse(e){if(!e)return e;let t="",s=this.pattern.split(""),i=e.split(""),n=0;for(let e=0,r=s.length;e<r;e++){"#"===s[e]?t+=i[n++]||"":n++}return t}}class E{constructor(e){this.scale=0,this.scale=e}format(e){if(isNaN(Number(e)))return"";let t;e=Number(e),t=this.scale>0?String(e.toFixed(this.scale)):String(e);let s=/(^[+-]?\d+)(\d{3})/;for(;s.test(t);)t=t.replace(s,"$1,$2");return t}parse(e){if(!e)return null;if(1===e.length&&/[+-]/.test(e)&&(e+="0"),e=e.replace(/,/gi,""),isNaN(Number(e)))throw"NaN";let t=Number(e);return this.scale>0&&(t=Number(t.toFixed(this.scale))),t}}class b{constructor(e){this.patternRex=/yyyy|yy|MM|dd|HH|hh|mm|ss/gi,this.pattern=e}format(e){if(!e)return"";let t=new Date(e);return e=this.pattern.replace(this.patternRex,(function(e){switch(e){case"yyyy":return t.getFullYear();case"yy":return String(t.getFullYear()%1e3).padStart(2,"0");case"MM":return String(t.getMonth()+1).padStart(2,"0");case"dd":return String(t.getDate()).padStart(2,"0");case"HH":return String(t.getHours()).padStart(2,"0");case"hh":return String(t.getHours()<=12?t.getHours():t.getHours()%12).padStart(2,"0");case"mm":return String(t.getMinutes()).padStart(2,"0");case"ss":return String(t.getSeconds()).padStart(2,"0");default:return e}}))}parse(e){if(!e)return null;let t,s=new Date(0,0,0,0,0,0);for(;null!=(t=this.patternRex.exec(this.pattern));){let i=t[0],n=t.index,r=i.length,l=e.substr(n,r);switch(l=l.padEnd(r,"0"),i){case"yyyy":{let e=parseInt(l);s.setFullYear(e);break}case"yy":{let e=parseInt(l),t=100*Math.floor((new Date).getFullYear()/100)+e;s.setFullYear(t);break}case"MM":{let e=parseInt(l);s.setMonth(e-1);break}case"dd":{let e=parseInt(l);s.setDate(e);break}case"HH":{let e=parseInt(l);s.setHours(e);break}case"hh":{let e=parseInt(l);s.setHours(e>12?e+12:e);break}case"mm":{let e=parseInt(l);s.setMinutes(e);break}case"ss":{let e=parseInt(l);s.setSeconds(e);break}}}let i=-1*(new Date).getTimezoneOffset(),n=i>=0?"+":"-",r=function(e){return(e<10?"0":"")+e};return s.getFullYear()+"-"+r(s.getMonth()+1)+"-"+r(s.getDate())+"T"+r(s.getHours())+":"+r(s.getMinutes())+":"+r(s.getSeconds())+n+r(Math.floor(Math.abs(i)/60))+":"+r(Math.abs(i)%60)}}class w{static getFormat(e){let t;const s=e.match(/^([a-zA-Z_][a-zA-Z0-9_]*)\((.*)\)$/);return s&&(s[1],t=s[2].split(",").map((e=>e.trim().replace(/^['"]|['"]$/g,"")))),e.startsWith("string")?new f(t[0]):e.startsWith("number")?new E(t[0]):e.startsWith("date")?new b(t[0]):null}}class v extends g{constructor(e,t,s){super(e,t,s),this.property=h(e,"property");let i=h(e,"format");i&&(this.format=w.getFormat(i))}getProperty(){return this.property}getFormat(){return this.format}render(){if(this.checkIf(),this.property){let e=P.getHandler(this.getBindData()),t=e.getValue(this.property);this.setValue(t);let s=e.isReadonly(this.property);this.setReadonly(s);let i=e.isDisable(this.property);this.setDisable(i)}this.executeScript()}checkIf(){let e=Object.assign({},this.getContext()),t=h(this.getHtmlElement(),"bind"),s=t.split(".");s.length>1?e[s[0]]=n(e,s[0]):e[t]=this.getBindData(),l(this.htmlElement,e)}executeScript(){let e=Object.assign({},this.getContext()),t=h(this.getHtmlElement(),"bind"),s=t.split(".");s.length>1?e[s[0]]=n(e,s[0]):e[t]=this.getBindData(),a(this.htmlElement,e)}update(e,t){console.debug("ObjectElement.update",e,t),e instanceof H&&(this.checkIf(),this.property&&(this.setValue(e.getValue(this.property)),this.setReadonly(e.isReadonly(this.property)),this.setDisable(e.isDisable(this.property))),this.executeScript())}setValue(e){null!=e?(e=this.getFormat()?this.getFormat().format(e):e,this.htmlElement.innerText=e):this.htmlElement.innerText=""}getValue(){let e=this.htmlElement.innerText;return e=e&&e.trim().length>0?this.getFormat()?this.getFormat().parse(e):e:null,e}setReadonly(e){}setDisable(e){}getIndex(){let e=h(this.htmlElement,"index");if(e)return Number(e)}focus(){return!1}}class x extends p{constructor(e,t,s,i){super(e),this.property=t,this.value=s,this.index=i}getProperty(){return this.property}getValue(){return this.value}getIndex(){return this.index}}class H extends y{constructor(){super()}get(e,t,s){return Reflect.get(e,t,s)}set(e,t,s){Reflect.set(e,t,s);let i=new x(this,t,s);return this.notifyObservers(i),!0}update(e,t){if(console.debug("ObjectHandler.update",e,t),e instanceof v){let s=e.getProperty(),i=e.getValue();this.checkListener(this.propertyChangingListener,t)&&(this.setValue(s,i),this.checkListener(this.propertyChangedListener,t))}this.notifyObservers(t)}getValue(e){return e=e.replace(".","?."),new Function(`return this.${e};`).call(this.getTarget())}setValue(e,t){new Function("value",`this.${e} = value;`).call(this.getTarget(),t)}focus(e){this.observers.forEach((t=>{if(t instanceof v&&t.getProperty()===e&&t.focus())return!1}))}}class D extends p{constructor(e,t,s){super(e),this.items=[],this.index=t,this.items=s}getIndex(){return this.index}getItems(){return this.items}}class I extends p{constructor(e,t){super(e),this.index=t}getIndex(){return this.index}}class C extends p{constructor(e,t,s){super(e),this.fromIndex=t,this.toIndex=s}getFromIndex(){return this.fromIndex}getToIndex(){return this.toIndex}}class L extends p{constructor(e,t,s){super(e),this.items=[],this.index=t,this.items=s}getIndex(){return this.index}getItems(){return this.items}}var A=window&&window.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(n,r){function l(e){try{o(i.next(e))}catch(e){r(e)}}function a(e){try{o(i.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,a)}o((i=i.apply(e,t||[])).next())}))};class O extends y{constructor(){super()}get(e,t,s){let i=this;const n=e[t];return"function"==typeof n?["push","unshift"].includes(t)?function(){let n;"push"===t?n=s.length:"unshift"===t&&(n=0);let r=[];for(let e in arguments)r.push(arguments[e]);return i.insertItem(e,n,...r),e.length}:["splice"].includes(t)?function(){var t=arguments;return A(this,void 0,void 0,(function*(){let s=t[0],n=t[1],r=[];for(let t=s;t<s+n;t++)r.push(e[t]);let l=[];for(let e=2;e<t.length;e++)l.push(t[e]);return n>0&&i.deleteItem(e,s,n),l.length>0&&i.insertItem(e,s,...l),r}))}:["pop","shift"].includes(t)?function(){return A(this,void 0,void 0,(function*(){let n;"pop"===t?n=s.length-1:"shift"===t&&(n=0);let r=[e[n]];return i.deleteItem(e,n),r}))}:n.bind(e):n}set(e,t,s){return Reflect.set(e,t,s),"length"===t&&this.notifyObservers(new p(this)),!0}update(e,t){if(console.debug("ArrayHandler.update",e,t),e instanceof F){if(t instanceof I)return void(this.selectedItemIndex=t.getIndex());if(t instanceof C){let e=this.getTarget().splice(t.getFromIndex(),1)[0];this.getTarget().splice(t.getToIndex(),0,e)}}this.notifyObservers(t)}insertItem(e,t,...s){let i=T.getHandler(e),n=T.getTarget(e);s.forEach(((e,t)=>{if("object"==typeof e){let i=new P(e),n=P.getHandler(i);n.propertyChangingListener=this.propertyChangingListener,n.propertyChangedListener=this.propertyChangedListener,s[t]=i}}));let r=new D(this,t,s);i.checkListener(i.rowInsertingListener,r)&&(n.splice(t,0,...s),i.checkListener(i.rowInsertedListener,r),i.notifyObservers(r))}deleteItem(e,t,s){let i=T.getHandler(e),n=T.getTarget(e),r=t,l=s?t+s:t+1,a=n.slice(r,l),o=new L(this,t,a);if(i.checkListener(i.rowDeletingListener,o)){let e=t,r=s||1;n.splice(e,r),i.checkListener(i.rowDeletedListener,o),i.notifyObservers(o)}}appendItem(e,...t){let s=e.length;return this.insertItem(e,s,...t)}selectItem(e){this.selectedItemIndex=e;let t=new I(this,this.selectedItemIndex);this.notifyObservers(t)}getSelectedItemIndex(){return this.selectedItemIndex}}class T extends globalThis.Array{constructor(e){if(super(),T.isProxy(e))return e;let t=new O;if(globalThis.Array.isArray(e))for(let t=0;t<e.length;t++)"object"==typeof e[t]&&(e[t]=new P(e[t]));let s=new Proxy(e,t);return t.setTarget(e),T.setHandler(s,t),T.setTarget(s,e),T.save(s),s}static isProxy(e){return e.hasOwnProperty("_target_")}static setTarget(e,t){globalThis.Object.defineProperty(e,"_target_",{value:t,writable:!0})}static getTarget(e){return globalThis.Object.getOwnPropertyDescriptor(e,"_target_").value}static setHandler(e,t){globalThis.Object.defineProperty(e,"_handler_",{value:t,writable:!0})}static getHandler(e){let t=globalThis.Object.getOwnPropertyDescriptor(e,"_handler_").value;return d(t,"handler is not found"),t}static assign(e,t){let s=this.getHandler(e);try{s.suspendListener(),s.suspendNotify(),e.length=0;for(let i=0;i<t.length;i++){let n=t[i];if("object"!=typeof n)continue;let r=new P(n);e[i]=r,P.setReadonlyAll(r,s.isReadonlyAll()),s.readonly.forEach((e=>{P.setReadonly(r,e,!0)})),P.setDisableAll(r,s.isDisableAll()),s.disable.forEach((e=>{P.setDisable(r,e,!0)})),P.onPropertyChanging(r,s.propertyChangingListener),P.onPropertyChanged(r,s.propertyChangedListener)}}finally{s.resumeListener(),s.resumeNotify()}s.notifyObservers(new p(this))}static clear(e){let t=this.getHandler(e);try{t.suspendListener(),t.suspendNotify(),e.length=0}finally{t.resumeListener(),t.resumeNotify()}t.notifyObservers(new p(this))}static save(e){let t=JSON.stringify(e);globalThis.Object.defineProperty(e,"_origin_",{value:t,writable:!0})}static reset(e){let t=JSON.parse(globalThis.Object.getOwnPropertyDescriptor(e,"_origin_").value);this.assign(e,t)}static setReadonly(e,t,s){this.getHandler(e).setReadonly(t,s),e.forEach((e=>{P.setReadonly(e,t,s)}))}static isReadonly(e,t){return this.getHandler(e).isReadonly(t)}static setReadonlyAll(e,t){this.getHandler(e).setReadonlyAll(t),e.forEach((e=>{P.setReadonlyAll(e,t)}))}static isReadonlyAll(e){return this.getHandler(e).isReadonlyAll()}static setDisable(e,t,s){this.getHandler(e).setDisable(t,s),e.forEach((e=>{P.setDisable(e,t,s)}))}static isDisable(e,t){return this.getHandler(e).isDisable(t)}static setDisableAll(e,t){this.getHandler(e).setDisableAll(t),e.forEach((e=>{P.setDisableAll(e,t)}))}static isDisableAll(e){return this.getHandler(e).isDisableAll()}static selectItem(e,t){return this.getHandler(e).selectItem(t)}static getSelectedItemIndex(e){return this.getHandler(e).getSelectedItemIndex()}static onPropertyChanging(e,t){this.getHandler(e).propertyChangingListener=t,e.forEach((e=>{P.getHandler(e).propertyChangingListener=t}))}static onPropertyChanged(e,t){this.getHandler(e).propertyChangedListener=t,e.forEach((e=>{P.getHandler(e).propertyChangedListener=t}))}static onRowInserting(e,t){this.getHandler(e).rowInsertingListener=t}static onRowInserted(e,t){this.getHandler(e).rowInsertedListener=t}static onRowDeleting(e,t){this.getHandler(e).rowDeletingListener=t}static onRowDeleted(e,t){this.getHandler(e).rowDeletedListener=t}}class P extends globalThis.Object{constructor(e){if(super(),P.isProxy(e))return e;let t=new H;for(let s in e){let i=e[s];if(Array.isArray(i)){let n=new T(i);T.getHandler(n).addObserver(t),e[s]=n}else if(null==i||"object"!=typeof i)e[s]=i;else{let n=new P(i);P.getHandler(n).addObserver(t),e[s]=n}}for(let t in e)Object.keys(e).includes(t)||delete this[t];let s=new Proxy(e,t);return t.setTarget(e),P.setHandler(s,t),P.setTarget(s,e),P.save(s),s}static isProxy(e){return e.hasOwnProperty("_target_")}static setTarget(e,t){globalThis.Object.defineProperty(e,"_target_",{value:t,writable:!0})}static getTarget(e){return globalThis.Object.getOwnPropertyDescriptor(e,"_target_").value}static setHandler(e,t){globalThis.Object.defineProperty(e,"_handler_",{value:t,writable:!0})}static getHandler(e){let t=globalThis.Object.getOwnPropertyDescriptor(e,"_handler_").value;return d(t,"handler is not found"),t}static assign(e,t){let s=this.getHandler(e);try{s.suspendListener(),s.suspendNotify();for(let i in t){let n=t[i];if(Array.isArray(n))Array.isArray(e[i])?T.assign(e[i],n):e[i]=new T(n);else if(null==n||"object"!=typeof n)e[i]=n;else if(null!=e[i]&&"object"==typeof e[i])P.assign(e[i],n);else{let e=new P(n);P.getHandler(e).addObserver(s),e[i]=e}}}finally{s.resumeListener(),s.resumeNotify()}s.notifyObservers(new p(this))}static clear(e){let t=this.getHandler(e);try{t.suspendListener(),t.suspendNotify();for(let t in e){let s=e[t];Array.isArray(s)?T.clear(s):null==s||"object"!=typeof s?e[t]=null:P.clear(s)}}finally{t.resumeListener(),t.resumeNotify()}t.notifyObservers(new p(this))}static save(e){let t=JSON.stringify(e);globalThis.Object.defineProperty(e,"_origin_",{value:t,writable:!0})}static reset(e){let t=JSON.parse(globalThis.Object.getOwnPropertyDescriptor(e,"_origin_").value);this.assign(e,t)}static setReadonly(e,t,s){this.getHandler(e).setReadonly(t,s)}static isReadonly(e,t){return this.getHandler(e).isReadonly(t)}static setReadonlyAll(e,t){this.getHandler(e).setReadonlyAll(t)}static isReadonlyAll(e){return this.getHandler(e).isReadonlyAll()}static setDisable(e,t,s){this.getHandler(e).setDisable(t,s)}static isDisable(e,t){return this.getHandler(e).isDisable(t)}static setDisableAll(e,t){this.getHandler(e).setDisableAll(t)}static isDisableAll(e){return this.getHandler(e).isDisableAll()}static focus(e,t){this.getHandler(e).focus(t)}static onPropertyChanging(e,t){this.getHandler(e).propertyChangingListener=t}static onPropertyChanged(e,t){this.getHandler(e).propertyChangedListener=t}}var B=window&&window.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(n,r){function l(e){try{o(i.next(e))}catch(e){r(e)}}function a(e){try{o(i.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,a)}o((i=i.apply(e,t||[])).next())}))};class F extends g{constructor(e,t,s){super(e.cloneNode(!0),t,s),this.editable=!1,this.slot=document.createElement("slot"),this.itemHtmlElements=[],this.loop=h(e,"loop"),this.hierarchy=h(e,"hierarchy"),this.editable="true"===h(e,"editable"),this.selectedItemClass=h(e,"selected-item-class"),e.replaceWith(this.slot),i(e)}render(){var e;let t=this.getBindData();if(this.itemHtmlElements.forEach((e=>{e.parentNode.removeChild(e)})),this.itemHtmlElements.length=0,this.loop){let s=this.loop.split(","),i=s[0].trim(),n=null===(e=s[1])||void 0===e?void 0:e.trim();if(this.hierarchy){let e=this.hierarchy.split(","),s=e[0],r=e[1];const l=this;let a=function(e,o,h){for(let c=0;c<e.length;c++){const d=e[c];if(d[r]===o){let r=Object.assign({},l.getContext());r[i]=d,r[n]=new P({index:c,count:c+1,size:t.length,first:0===c,last:t.length==c+1,depth:h}),l.createItemHtmlElement(c,d,r);let o=d[s];a(e,o,h+1)}}};a(t,null,0)}else for(let e=0;e<t.length;e++){let s=t[e],r=Object.assign({},this.getContext());r[i]=s,r[n]=new P({index:e,count:e+1,size:t.length,first:0===e,last:t.length==e+1}),this.createItemHtmlElement(e,s,r)}}else{let e=this.getHtmlElement().cloneNode(!0),t=Object.assign({},this.getContext());V.initialize(e,this.getContext()),this.itemHtmlElements.push(e),this.slot.parentNode.insertBefore(e,this.slot),l(e,t),a(e,t)}}createItemHtmlElement(e,t,s){let i=this.getHtmlElement().cloneNode(!0);c(i,"index",e.toString());let n=this;this.editable&&(i.setAttribute("draggable","true"),i.addEventListener("dragstart",(function(e){let t=h(this,"index");e.dataTransfer.setData("text",t)})),i.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation()})),i.addEventListener("drop",(function(e){return B(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation();let t=parseInt(e.dataTransfer.getData("text")),s=parseInt(h(this,"index")),i=new C(n,t,s);n.notifyObservers(i)}))}))),V.initialize(i,s,e),this.itemHtmlElements.push(i),this.slot.parentNode.insertBefore(i,this.slot),l(i,s),a(i,s),i.addEventListener("click",(t=>{this.selectedItemClass&&(this.itemHtmlElements.forEach((e=>{e.classList.remove(this.selectedItemClass)})),t.currentTarget.classList.add(this.selectedItemClass),t.stopPropagation());let s=new I(this,e);this.notifyObservers(s)}))}update(e,t){if(console.debug("ArrayElement.update",e,t),e instanceof O){if(t instanceof I){if(this.selectedItemClass){this.itemHtmlElements.forEach((e=>e.classList.remove(this.selectedItemClass))),t.getIndex()>=0&&this.itemHtmlElements.forEach((e=>{e.dataset.duiceIndex===t.getIndex().toString()&&e.classList.add(this.selectedItemClass)}))}return}this.render()}}}class S extends u{createElement(e,t,s){return new F(e,t,s)}}class N extends u{createElement(e,t,s){return this.doCreateElement(e,t,s)}}class R extends u{createElement(e,t,s){return new v(e,t,s)}}class k{static register(e,t){t instanceof S?this.arrayElementFactories.set(e,t):t instanceof R?this.objectElementFactories.set(e,t):t instanceof N&&this.customElementFactories.set(e,t),e.includes("-")&&globalThis.customElements.define(e,class extends HTMLElement{})}static getFactory(e,t,s){let i=e.tagName.toLowerCase();return this.customElementFactories.has(i)?this.customElementFactories.get(i):Array.isArray(t)?this.arrayElementFactories.has(i)?this.arrayElementFactories.get(i):this.defaultArrayElementFactory:this.objectElementFactories.has(i)?this.objectElementFactories.get(i):this.defaultObjectElementFactory}}k.defaultObjectElementFactory=new R,k.defaultArrayElementFactory=new S,k.objectElementFactories=new Map,k.arrayElementFactories=new Map,k.customElementFactories=new Map;class V{static initialize(e,t,i){e.querySelectorAll(s()).forEach((s=>{var r,l;const a=s;if(!o(a,"id"))try{let e=h(a,"bind"),s=n(t,e);null===(l=null===(r=k.getFactory(a,s,t))||void 0===r?void 0:r.createElement(a,s,t))||void 0===l||l.render(),void 0!==i&&c(a,"index",i.toString())}catch(s){console.error(s,a,e,JSON.stringify(t))}}))}}var _=window&&window.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(n,r){function l(e){try{o(i.next(e))}catch(e){r(e)}}function a(e){try{o(i.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,a)}o((i=i.apply(e,t||[])).next())}))};class j extends v{constructor(e,t,s){super(e,t,s),this.editable=!1,this.closeButtonImg="data:image/svg+xml;base64,"+window.btoa('<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path opacity="0.4" d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="#292D32"></path> <path d="M13.0594 12.0001L15.3594 9.70011C15.6494 9.41011 15.6494 8.93011 15.3594 8.64011C15.0694 8.35011 14.5894 8.35011 14.2994 8.64011L11.9994 10.9401L9.69937 8.64011C9.40937 8.35011 8.92937 8.35011 8.63938 8.64011C8.34938 8.93011 8.34938 9.41011 8.63938 9.70011L10.9394 12.0001L8.63938 14.3001C8.34938 14.5901 8.34938 15.0701 8.63938 15.3601C8.78938 15.5101 8.97937 15.5801 9.16937 15.5801C9.35937 15.5801 9.54937 15.5101 9.69937 15.3601L11.9994 13.0601L14.2994 15.3601C14.4494 15.5101 14.6394 15.5801 14.8294 15.5801C15.0194 15.5801 15.2094 15.5101 15.3594 15.3601C15.6494 15.0701 15.6494 14.5901 15.3594 14.3001L13.0594 12.0001Z" fill="#292D32"></path> </g></svg>'),this.originSrc=String(this.getHtmlElement().src),this.editable="true"===h(this.getHtmlElement(),"editable"),this.editable&&(this.getHtmlElement().style.cursor="pointer",this.getHtmlElement().addEventListener("click",(e=>{this.changeImage()})),this.clearButton=document.createElement("img"),this.clearButton.src=this.closeButtonImg,this.clearButton.style.cursor="pointer",this.clearButton.style.width="16px",this.clearButton.style.height="16px",this.clearButton.addEventListener("mouseout",(e=>{this.hideClearImageButton()}),!0),this.clearButton.addEventListener("click",(e=>{this.clearImage()})),this.getHtmlElement().addEventListener("mouseover",(e=>{this.showClearImageButton()}),!0),this.getHtmlElement().addEventListener("mouseout",(e=>{e.relatedTarget!==this.clearButton&&this.hideClearImageButton()}),!0));let i=h(this.getHtmlElement(),"size");if(i){let e=i.split(",");this.width=parseInt(e[0].trim()),this.height=parseInt(e[1].trim())}}showClearImageButton(){this.getHtmlElement().parentNode.insertBefore(this.clearButton,this.getHtmlElement().nextSibling),this.clearButton.style.position="absolute",this.clearButton.style.zIndex="100"}hideClearImageButton(){this.getHtmlElement().parentNode.removeChild(this.clearButton)}clearImage(){this.originSrc?this.getHtmlElement().src=this.originSrc:this.getHtmlElement().src=null;let e=new x(this,this.getProperty(),this.getValue(),this.getIndex());this.notifyObservers(e)}changeImage(){let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/gif, image/jpeg, image/png");let t=this;e.addEventListener("change",(function(e){let s=new FileReader;this.files&&this.files[0]&&(s.addEventListener("load",(e=>_(this,void 0,void 0,(function*(){let s,i=e.target.result;s=t.width&&t.height?yield t.convertImage(i,t.width,t.height):yield t.convertImage(i),t.setValue(s);let n=new x(t,t.getProperty(),t.getValue(),t.getIndex());t.notifyObservers(n)})))),s.readAsDataURL(this.files[0])),e.preventDefault(),e.stopPropagation()})),e.click()}convertImage(e,t,s){return new Promise((function(i,n){try{let n=document.createElement("canvas"),r=n.getContext("2d"),l=new Image;l.onload=function(){t&&s?(n.width=t,n.height=s,r.drawImage(l,0,0,t,s)):(n.width=l.naturalWidth,n.height=l.naturalHeight,r.drawImage(l,0,0));let e=n.toDataURL("image/png");i(e)},l.src=e}catch(e){n(e)}}))}setValue(e){this.getHtmlElement().src=e||this.originSrc}getValue(){let e=this.getHtmlElement().src;return e===this.originSrc?null:e}setReadonly(e){this.getHtmlElement().style.pointerEvents=e?"none":"unset"}setDisable(e){this.getHtmlElement().style.pointerEvents=e?"none":"unset"}}class M extends R{createElement(e,t,s){return new j(e,t,s)}}k.register("img",new M);class z extends v{constructor(e,t,s){super(e,t,s),this.getHtmlElement().addEventListener("change",(e=>{let t=new x(this,this.getProperty(),this.getValue(),this.getIndex());this.notifyObservers(t)}),!0),this.getHtmlElement().setAttribute("autocomplete","off")}setValue(e){e=null!=e?this.getFormat()?this.getFormat().format(e):e:"",this.getHtmlElement().value=e}getValue(){let e=this.getHtmlElement().value;return e=e?this.getFormat()?this.getFormat().parse(e):e:null,e}setReadonly(e){this.getHtmlElement().readOnly=e}setDisable(e){e?this.getHtmlElement().setAttribute("disabled","disabled"):this.getHtmlElement().removeAttribute("disabled")}focus(){return this.getHtmlElement().focus(),!0}}class $ extends z{constructor(e,t,s){super(e,t,s),this.getHtmlElement().setAttribute("type","text"),this.getHtmlElement().style.textAlign="right",this.getHtmlElement().addEventListener("keypress",(e=>{!1===/[\d|\.|,]/.test(e.key)&&e.preventDefault()}))}getValue(){let e=super.getValue();return Number(e)}}class W extends z{constructor(e,t,s){super(e,t,s),this.trueValue=!0,this.falseValue=!1;let i=h(this.getHtmlElement(),"true-value");this.trueValue=i||this.trueValue;let n=h(this.getHtmlElement(),"false-value");this.falseValue=n||this.falseValue}setValue(e){e===this.trueValue?this.getHtmlElement().checked=!0:this.htmlElement.checked=!1}getValue(){return this.htmlElement.checked?this.trueValue:this.falseValue}disableClick(e){e.preventDefault()}setReadonly(e){e?this.getHtmlElement().addEventListener("click",this.disableClick):this.getHtmlElement().removeEventListener("click",this.disableClick)}}class Y extends z{constructor(e,t,s){super(e,t,s),this.dateFormat=new b("yyyy-MM-ddTHH:mm")}setValue(e){this.getHtmlElement().value=e?this.dateFormat.format(e):""}getValue(){let e=this.getHtmlElement().value;return e?new Date(e).toISOString():null}}class X extends z{constructor(e,t,s){super(e,t,s)}setValue(e){this.getHtmlElement().checked=this.getHtmlElement().value===e}getValue(){return this.getHtmlElement().value}setReadonly(e){this.getHtmlElement().style.pointerEvents=e?"none":""}}class J extends R{createElement(e,t,s){switch(e.getAttribute("type")){case"number":return new $(e,t,s);case"checkbox":return new W(e,t,s);case"radio":return new X(e,t,s);case"datetime-local":return new Y(e,t,s);default:return new z(e,t,s)}}}k.register("input",new J);class Z extends v{constructor(e,t,s){super(e,t,s),this.defaultOptions=[],this.getHtmlElement().addEventListener("change",(()=>{let e=new x(this,this.getProperty(),this.getValue(),this.getIndex());this.notifyObservers(e)}),!0);for(let e=0;e<this.getHtmlElement().options.length;e++)this.defaultOptions.push(this.getHtmlElement().options[e]);let i=h(this.getHtmlElement(),"option");i&&(this.option=n(this.getContext(),i),this.optionValueProperty=h(this.getHtmlElement(),"option-value-property"),this.optionTextProperty=h(this.getHtmlElement(),"option-text-property"),T.getHandler(this.option).addObserver(this),this.updateOptions())}updateOptions(){let e=this.getHtmlElement().value;this.getHtmlElement().innerHTML="",this.defaultOptions.forEach((e=>{this.getHtmlElement().appendChild(e)})),this.option.forEach((e=>{let t=document.createElement("option");t.value=e[this.optionValueProperty],t.appendChild(document.createTextNode(e[this.optionTextProperty])),this.getHtmlElement().appendChild(t)})),this.getHtmlElement().value=e}update(e,t){super.update(e,t),this.option&&this.updateOptions()}setValue(e){if(this.getHtmlElement().value=e,!e)for(let e=0;e<this.getHtmlElement().options.length;e++){let t=this.getHtmlElement().options[e];if(!t.nodeValue){t.selected=!0;break}}}getValue(){let e=this.getHtmlElement().value;return(!e||e.trim().length<1)&&(e=null),e}setReadonly(e){e?(console.warn("==ok"),this.getHtmlElement().style.pointerEvents="none"):this.getHtmlElement().style.pointerEvents=""}setDisable(e){e?this.getHtmlElement().setAttribute("disabled","disabled"):this.getHtmlElement().removeAttribute("disabled")}}class q extends R{createElement(e,t,s){return new Z(e,t,s)}}k.register("select",new q);class G extends v{constructor(e,t,s){super(e,t,s),this.getHtmlElement().addEventListener("change",(e=>{let t=new x(this,this.getProperty(),this.getValue(),this.getIndex());this.notifyObservers(t)}),!0)}setValue(e){this.getHtmlElement().value=null!=e?e:""}getValue(){let e=this.getHtmlElement().value;return null!=e&&e.length>0?e:null}setReadonly(e){e?this.getHtmlElement().setAttribute("readonly","readonly"):this.getHtmlElement().removeAttribute("readonly")}setDisable(e){e?this.getHtmlElement().setAttribute("disabled","disabled"):this.getHtmlElement().removeAttribute("disabled")}}class K extends R{createElement(e,t,s){return new G(e,t,s)}}k.register("textarea",new K);var U=window&&window.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(n,r){function l(e){try{o(i.next(e))}catch(e){r(e)}}function a(e){try{o(i.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,a)}o((i=i.apply(e,t||[])).next())}))};class Q{constructor(e){this.dialogElement=e;let t=this;this.dialogElement.style.position="absolute",this.dialogElement.style.left="0",this.dialogElement.style.right="0",this.dialogElement.style.overflowX="hidden",this.dialogElement.style.boxSizing="border-box",this.dialogElement.style.maxWidth="100%",this.header=document.createElement("div"),this.dialogElement.appendChild(this.header),this.header.style.display="flex",this.header.style.justifyContent="end",this.header.style.lineHeight="2rem",this.header.style.position="absolute",this.header.style.left="0",this.header.style.top="0",this.header.style.width="100%",this.header.style.cursor="pointer",this.header.onmousedown=function(e){let s=0,i=0,n=0,r=0;n=e.clientX,r=e.clientY,window.document.onmouseup=function(e){window.document.onmousemove=null,window.document.onmouseup=null},window.document.onmousemove=function(e){s=n-e.clientX,i=r-e.clientY,n=e.clientX,r=e.clientY,t.dialogElement.style.left=t.dialogElement.offsetLeft-s+"px",t.dialogElement.style.top=t.dialogElement.offsetTop-i+"px"}},this.closeButton=document.createElement("span"),this.closeButton.innerHTML="&#10005;",this.closeButton.style.fontFamily="monospace",this.closeButton.style.fontSize="large",this.closeButton.style.marginLeft="0.5rem",this.closeButton.style.marginRight="0.5rem",this.closeButton.addEventListener("click",(e=>{t.hide(),t.close()})),this.dialogElement.addEventListener("scroll",(()=>{const e=this.dialogElement.scrollTop;this.header.style.top=`${e}px`})),this.header.appendChild(this.closeButton),window.addEventListener("resize",(function(e){t.moveToCenterPosition()}))}onOpening(e){return this.openingListener=e,this}onOpened(e){return this.openedListener=e,this}onClosing(e){return this.closingListener=e,this}onClosed(e){return this.closedListener=e,this}moveToCenterPosition(){window.getComputedStyle(this.dialogElement),this.dialogElement.style.boxSizing="border-box";let e=this.dialogElement.offsetWidth,t=this.dialogElement.offsetHeight,s=window.scrollX,i=window.scrollY;this.dialogElement.style.left=Math.max(0,window.innerWidth/2-e/2)+s+"px",this.dialogElement.style.top=Math.max(0,window.innerHeight/3-t/3)+i+"px"}getDialogElement(){return this.dialogElement}show(){let e=window.scrollX,t=window.scrollY;this.dialogElement.style.opacity="0",window.document.body.appendChild(this.dialogElement),this.dialogElement.showModal(),window.scrollTo(e,t),this.moveToCenterPosition();let s=this;!function e(){let t=parseFloat(s.dialogElement.style.opacity);(t+=.1)>1||(s.dialogElement.style.opacity=String(t),requestAnimationFrame(e))}()}hide(){this.dialogElement.close()}open(){return U(this,void 0,void 0,(function*(){if(this.openingListener&&0==this.openingListener.call(this))return;this.show(),this.openedListener&&this.openedListener.call(this);let e=this;return this.promise=new Promise((function(t,s){e.promiseResolve=t,e.promiseReject=s})),this.promise}))}close(...e){this.closingListener&&0==this.closingListener.call(this)||(this.closedListener&&this.closedListener.call(this),this.hide(),this.promiseResolve(...e))}}return globalThis.document&&document.addEventListener("DOMContentLoaded",(e=>{V.initialize(document.documentElement,{})})),globalThis.window&&["popstate","pageshow"].forEach((e=>{window.addEventListener(e,(t=>{("pageshow"!==e||t.persisted)&&document.dispatchEvent(new CustomEvent("DOMContentLoaded"))}))})),e.AlertDialog=class extends Q{constructor(e){super(document.createElement("dialog")),this.getDialogElement().style.padding="1rem",this.getDialogElement().style.minWidth="20rem",this.getDialogElement().style.textAlign="center",this.messagePre=document.createElement("pre"),this.messagePre.style.whiteSpace="pre-wrap",this.messagePre.style.marginTop="1rem",this.messagePre.style.marginBottom="1rem",this.messagePre.innerHTML=e,this.getDialogElement().appendChild(this.messagePre),this.confirmButton=document.createElement("button"),this.confirmButton.appendChild(document.createTextNode("OK")),this.confirmButton.style.width="5em",this.confirmButton.style.cursor="pointer",this.confirmButton.addEventListener("click",(e=>{this.confirm()})),this.getDialogElement().appendChild(this.confirmButton)}open(){let e=super.open();return this.confirmButton.focus(),e}confirm(){super.close(),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}close(){super.close(),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}},e.ArrayElement=F,e.ArrayElementFactory=S,e.ArrayProxy=T,e.Configuration=t,e.ConfirmDialog=class extends Q{constructor(e){super(document.createElement("dialog")),this.getDialogElement().style.padding="1rem",this.getDialogElement().style.minWidth="20rem",this.getDialogElement().style.textAlign="center",this.messagePre=document.createElement("pre"),this.messagePre.style.whiteSpace="pre-wrap",this.messagePre.style.marginTop="1rem",this.messagePre.style.marginBottom="1rem",this.messagePre.innerHTML=e,this.getDialogElement().appendChild(this.messagePre),this.cancelButton=document.createElement("button"),this.cancelButton.appendChild(document.createTextNode("Cancel")),this.cancelButton.style.width="5em",this.cancelButton.style.cursor="pointer",this.cancelButton.addEventListener("click",(e=>{this.cancel()})),this.getDialogElement().appendChild(this.cancelButton),this.getDialogElement().appendChild(document.createTextNode(" ")),this.confirmButton=document.createElement("button"),this.confirmButton.appendChild(document.createTextNode("OK")),this.confirmButton.style.width="5em",this.confirmButton.style.cursor="pointer",this.confirmButton.addEventListener("click",(e=>{this.confirm()})),this.getDialogElement().appendChild(this.confirmButton)}open(){let e=super.open();return this.confirmButton.focus(),e}close(...e){super.close(!1),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}confirm(){super.close(!0),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}cancel(){super.close(!1),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}},e.CustomElement=class extends g{constructor(e,t,s){super(e,t,s)}render(){this.doRender(this.getBindData()),l(this.getHtmlElement(),this.getContext()),V.initialize(this.getHtmlElement(),this.getContext()),a(this.getHtmlElement(),this.getContext())}update(e,t){e instanceof y&&this.doUpdate(e.getTarget())}},e.CustomElementFactory=N,e.DataElementRegistry=k,e.Dialog=Q,e.ImgElementFactory=M,e.Initializer=V,e.InputElementFactory=J,e.ObjectElement=v,e.ObjectElementFactory=R,e.ObjectProxy=P,e.PromptDialog=class extends Q{constructor(e,t){super(document.createElement("dialog")),this.getDialogElement().style.padding="1rem",this.getDialogElement().style.minWidth="20rem",this.getDialogElement().style.textAlign="center",this.messagePre=document.createElement("pre"),this.messagePre.style.whiteSpace="pre-wrap",this.messagePre.style.marginTop="1rem",this.messagePre.style.marginBottom="1rem",this.messagePre.innerHTML=e,this.getDialogElement().appendChild(this.messagePre),this.promptInput=document.createElement("input"),this.promptInput.style.textAlign="center",this.promptInput.style.marginBottom="1rem",this.promptInput.style.width="100%",t&&(this.promptInput.type=t),this.getDialogElement().appendChild(this.promptInput),this.cancelButton=document.createElement("button"),this.cancelButton.appendChild(document.createTextNode("Cancel")),this.cancelButton.style.width="5em",this.cancelButton.style.cursor="pointer",this.cancelButton.addEventListener("click",(e=>{this.cancel()})),this.getDialogElement().appendChild(this.cancelButton),this.getDialogElement().appendChild(document.createTextNode(" ")),this.confirmButton=document.createElement("button"),this.confirmButton.appendChild(document.createTextNode("OK")),this.confirmButton.style.width="5em",this.confirmButton.style.cursor="pointer",this.confirmButton.addEventListener("click",(e=>{this.confirm(this.promptInput.value)})),this.getDialogElement().appendChild(this.confirmButton)}open(){let e=super.open();return this.promptInput.focus(),e}close(...e){super.close(),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}confirm(e){super.close(e),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}cancel(){super.close(),this.getDialogElement().parentNode.removeChild(this.getDialogElement())}},e.SelectElementFactory=q,e.TabFolder=class{constructor(){this.items=[]}addItem(e){e.setTabFolder(this),e.setTabIndex(this.items.length),this.items.push(e)}setActive(e){for(let t=0;t<this.items.length;t++)this.items[t].setActive(t===e)}},e.TabItem=class{constructor(e,t,s){this.button=e,this.content=t,this.listener=s,e.style.cursor="pointer";let i=this;e.addEventListener("click",(()=>{i.tabFolder.setActive(i.tabIndex)})),this.setActive(!1)}setTabFolder(e){this.tabFolder=e}setTabIndex(e){this.tabIndex=e}setActive(e){e?(this.button.style.opacity="unset",this.content.removeAttribute("hidden"),this.listener.call(this)):(this.button.style.opacity="0.5",this.content.setAttribute("hidden",String(!0)))}},e.TextareaElementFactory=K,e.assert=d,e.findVariable=n,e.getElementAttribute=h,e.getElementQuerySelector=s,e.hasElementAttribute=o,e.markInitialized=i,e.runCode=r,e.runExecuteCode=a,e.runIfCode=l,e.setElementAttribute=c,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=duice.min.js.map
